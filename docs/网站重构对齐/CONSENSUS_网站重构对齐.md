# 网站重构对齐 - 共识文档

## 📋 需求描述和验收标准

### 核心需求
基于现有CIE Copilot项目的深度分析，需要解决以下关键问题：

1. **导航栏路由不匹配问题**
   - 导航栏指向`/tools/*`路径，但实际页面在`/pages/*`
   - Smart Function功能页面命名不一致
   - 用户无法正常访问功能页面

2. **Community内容与CIE考纲对齐问题**
   - 当前Community功能主要支持数学科目
   - 物理科目内容不完整（仅25个主题）
   - 数学(9709)和进阶数学(9231)主题数据为0
   - Community问题类型和标签系统需要与CIE考纲结构对齐

3. **Smart Function功能完善**
   - 进度追踪功能已实现但需要优化
   - 智能推荐功能需要更好的CIE考纲对齐
   - 图像解决方案功能需要增强

### 验收标准

#### 1. 路由修复验收标准
- [ ] 所有导航栏链接能正确跳转到对应页面
- [ ] Smart Function功能页面路径统一为`/tools/*`格式
- [ ] 用户能够无障碍访问所有功能模块
- [ ] 路由配置与实际文件结构保持一致

#### 2. Community内容对齐验收标准
- [ ] 支持完整的CIE科目体系（数学9709、进阶数学9231、物理9702）
- [ ] 每个科目的主题数据完整导入
- [ ] Community问题类型与CIE考纲章节对应
- [ ] 标签系统反映CIE考纲的知识点结构
- [ ] 用户能够按科目、难度、主题进行问题筛选

#### 3. Smart Function功能验收标准
- [ ] 进度追踪准确反映用户在各科目的学习进度
- [ ] 智能推荐基于CIE考纲和用户学习数据
- [ ] 图像解决方案支持多科目题目识别
- [ ] 学习建议与CIE考试要求对齐

## 🔧 技术实现方案

### 技术栈确认
- **前端**: React 18 + Vite + Tailwind CSS
- **后端**: Supabase (PostgreSQL + Auth + Storage)
- **AI服务**: OpenAI API
- **状态管理**: React Context + Custom Hooks
- **路由**: React Router v6

### 架构约束
- 保持现有组件结构和设计风格
- 复用现有服务层（userProfileService, contentRecommendationService等）
- 遵循现有的数据库表结构
- 保持与Supabase的集成方式

### 集成方案

#### 1. 路由重构方案
```
当前结构: src/pages/Tools*.jsx
目标结构: src/pages/tools/*.jsx 或 调整路由配置

选择方案: 调整路由配置，保持现有文件结构
- 修改App.jsx中的路由配置
- 更新导航组件中的链接路径
- 确保所有内部链接使用正确路径
```

#### 2. 数据库扩展方案
```
现有表结构:
- community_questions (已存在，功能完整)
- community_tags (已存在)
- content_tags (已存在)
- subjects, papers, topics (部分数据缺失)

扩展方案:
- 补充缺失的科目主题数据
- 创建CIE考纲对应的标签体系
- 建立科目-主题-标签的关联关系
```

#### 3. Community内容对齐方案
```
数据层面:
- 修复数学和进阶数学的主题数据
功能层面:
- 增强CommunityInterface组件的科目支持
- 优化问题筛选和搜索功能
- 改进推荐算法的科目适配性
```

## 🎯 任务边界和限制

### 包含范围
1. 路由配置修复和优化
2. Community功能的CIE考纲对齐
3. Smart Function功能的完善和优化
4. 数据库数据补充和结构优化
5. 用户界面的一致性改进

### 不包含范围
1. 大规模UI重设计
2. 新功能模块的开发
3. 第三方服务的替换
4. 性能优化（除非影响核心功能）
5. 移动端适配的大幅改动

### 技术限制
1. 必须保持与现有Supabase配置的兼容性
2. 不能破坏现有用户数据
3. 保持现有API接口的稳定性
4. 遵循现有的代码规范和组件模式

## ✅ 关键假设确认

### 数据假设
- Supabase数据库连接正常且稳定
- 现有用户数据结构不需要大幅调整
- CIE考纲数据可以通过现有数据源获取

### 技术假设
- React Router v6的路由配置可以灵活调整
- 现有组件架构支持功能扩展
- Supabase的RLS策略不需要大幅修改

### 业务假设
- 用户主要使用数学、进阶数学、物理三个科目
- Community功能是用户的核心需求之一
- Smart Function功能需要与学习进度紧密结合

## 🔍 风险评估

### 高风险项
1. **数据迁移风险**: 主题数据补充可能影响现有关联关系
2. **路由变更风险**: 可能影响用户书签和外部链接

### 中风险项
1. **组件重构风险**: Smart Function组件调整可能影响用户体验
2. **性能风险**: Community数据增加可能影响查询性能

### 缓解措施
1. 数据备份和分步迁移
2. 渐进式路由更新和重定向配置
3. 充分的测试和回滚方案

---