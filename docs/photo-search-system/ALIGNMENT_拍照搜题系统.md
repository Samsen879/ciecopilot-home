# 拍照搜题系统需求对齐文档

## 原始需求重新理解

### 用户真实需求
- **核心功能**: 拍照搜题 - 用户通过拍照上传题目图片，系统识别并匹配相似题目
- **技术流程**: 拍照 → OCR识别 → 题目匹配 → 返回相关题目和答案
- **目标用户**: 学生群体，需要快速找到相似题目和解答

### 当前PDF RAG化方案的问题分析

#### 当前方案 (PDF文档检索)
- **数据结构**: 将PDF按文本块切分，生成向量嵌入
- **检索方式**: 基于文本相似度的语义搜索
- **适用场景**: 文档内容检索、知识问答
- **局限性**: 无法有效处理数学公式、图形、题目结构

#### 拍照搜题的实际需求
- **数据结构**: 需要题目级别的结构化数据，包含题目文本、公式、图片、答案
- **检索方式**: 基于题目内容的精确匹配和相似度计算
- **技术要求**: OCR识别、数学公式解析、题目结构化存储

## 技术方案重新设计

### 方案A: 题目结构化存储 + 智能匹配

#### 数据处理流程
1. **PDF解析**: 按题目单位解析，而非文本块
2. **题目提取**: 识别题目边界、题号、题目内容、答案
3. **结构化存储**: 题目文本、数学公式、图片、元数据
4. **索引建立**: 多维度索引（文本、公式、关键词）

#### 搜索匹配流程
1. **图片上传**: 用户拍照上传题目图片
2. **OCR识别**: 提取文本内容和数学公式
3. **题目解析**: 识别题目结构和关键信息
4. **相似度计算**: 多维度匹配（文本相似度、公式匹配、关键词匹配）
5. **结果排序**: 按相似度返回最匹配的题目

### 方案B: 混合检索系统

#### 保留部分RAG能力
- **文档级检索**: 用于概念解释、知识点查询
- **题目级检索**: 用于精确题目匹配

#### 双重索引结构
- **向量索引**: 用于语义相似度搜索
- **结构化索引**: 用于精确题目匹配

## 关键技术挑战

### 1. OCR识别准确性
- **数学公式识别**: LaTeX格式转换
- **手写文字识别**: 提高识别准确率
- **图形识别**: 几何图形、图表处理

### 2. 题目边界识别
- **自动分割**: 从PDF中自动识别题目边界
- **题目编号**: 识别题号和子题
- **答案关联**: 题目与答案的正确匹配

### 3. 相似度计算算法
- **文本相似度**: 基于语义的文本匹配
- **公式相似度**: 数学表达式的结构化比较
- **综合评分**: 多维度权重计算

## 疑问澄清

### 需要用户确认的关键问题

1. **数据范围**: 
   - 是否只处理9702物理试卷，还是扩展到其他科目？
   - 是否需要包含历年真题和模拟题？

2. **功能优先级**:
   - 拍照搜题是否为最高优先级功能？
   - 是否还需要保留文档检索功能？

3. **技术要求**:
   - 对搜索准确率的期望是多少？
   - 是否需要支持手写题目识别？
   - 是否需要支持复杂的数学公式和图形？

4. **用户体验**:
   - 期望的响应时间是多少？
   - 是否需要显示多个相似题目供用户选择？

## 建议的实施策略

### 阶段1: 停止当前PDF RAG化
- 暂停大规模PDF文档向量化
- 保留已完成的小批量数据作为测试

### 阶段2: 重新设计数据结构
- 设计题目结构化存储方案
- 建立题目级别的数据库表结构

### 阶段3: 开发题目提取工具
- PDF题目自动分割
- 题目内容结构化提取

### 阶段4: 实现拍照搜题功能
- OCR集成和优化
- 相似度匹配算法
- 前端拍照界面

## 下一步行动

等待用户确认以上疑问后，制定详细的技术实施方案。